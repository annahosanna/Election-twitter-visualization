<!DOCTYPE html >
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>
			Using GeoJSON
		</title>
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="http://d3js.org/colorbrewer.v1.min.js"></script>

		<style type="text/css">

<<<<<<< HEAD
		div.tooltip {
		  position:absolute;
			width:auto;
		  height:auto;
		  padding:10px;
		  background-color: #fff;
		  border-radius:2px;
	}

	.hidden{
	  display:none;
	}

/*	#info p{
	  margin:0px;
	  font-family:sans-serif;
	  font-size:12px;
	} */

=======
>>>>>>> ad8f219b0adbdc3f60a3ae7cc5d78995fdef3b2b

		</style>
	</head>
	<body>
    <p>Candidate: <select id="candidateSelect"><optgroup label="Candidates" id="cmetrics"></optgroup></select></p>
		<script type="text/javascript">

		// SVG region
		var width = 800, height = 500;

		var svg = d3.select("body")
				.append("svg")
				.attr({"width":width, "height":height});

		// projection that maps from latitude &longitude to x & y coordiantes
		var projection = d3.geo.albersUsa()
				.translate([width/2, height/2]);

<<<<<<< HEAD
		var tooltip = d3.select('body').append('div')
			.attr('class', 'hidden tooltip');

=======
>>>>>>> ad8f219b0adbdc3f60a3ae7cc5d78995fdef3b2b
		// path: geo JSOn to svg
		var path = d3.geo.path().projection(projection);

    //chosen candidate in dropdown menu
    var candidateChoice = "Bernie Sanders";
    //array that will hold races of chosen candidate
    var thisCandidate = [];
<<<<<<< HEAD
		var dem = [];
		var rep = [];
=======
>>>>>>> ad8f219b0adbdc3f60a3ae7cc5d78995fdef3b2b

    // create our coloring tool
    var color = d3.scale.quantize()
        .range(colorbrewer.Greys[8].reverse());
        //.range(colorbrewer.YlGnBu[8].reverse());

<<<<<<< HEAD
		var colorParty = d3.scale.ordinal()
    		.range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

    var candidateList = ["Bernie Sanders", "Ben Carson", "Carly Fiorina", "Chris Christie", "Donald Trump", "Hillary Clinton", "Jeb Bush", "John Kasich", "Marco Rubio", "Martin O'Malley", "Mike Huckabee", "Rand Paul", "Rick Santorum", "Ted Cruz", "Democrats", "Republicans"];

    var candidateMenu = d3.select("#cmetrics");
    for(var i = 0; i < candidateList.length; i++){
      //console.log(candidateList[i]);
=======
    var candidateList = ["Bernie Sanders", "Ben Carson", "Carly Fiorina", "Chris Christie", "Donald Trump", "Hillary Clinton", "Jeb Bush", "John Kasich", "Marco Rubio", "Martin O'Malley", "Mike Huckabee", "Rand Paul", "Rick Santorum", "Ted Cruz"];

    var candidateMenu = d3.select("#cmetrics");
    for(var i = 0; i < candidateList.length; i++){
      console.log(candidateList[i]);
>>>>>>> ad8f219b0adbdc3f60a3ae7cc5d78995fdef3b2b
      candidateMenu.append("option").attr("value", candidateList[i]).text(candidateList[i]);
    }



          // fetch our data -- first the map, and then the CSV data (the order matters little here since we
      		// are not displaying anything until the binding is done)
      		d3.json("http://www.cs.middlebury.edu/~candrews/classes/infovis/data/us-states.json", function(mapData){
      			d3.csv("final_primary_data.csv", function (primaryData) {

              // set the domain for our color scale now that we have data
                color.domain(d3.extent(primaryData, function (d) {return +d.prop;	}));

<<<<<<< HEAD
	primaryData.forEach(function(d){
		if(d.candidate == "Bernie Sanders" || d.candidate == "Hillary Clinton"){
			dem.push(d);
		}
		else{
			rep.push(d);
		}
	})

	dem = d3.nest()
			.key(function(d) {return d.state;})
			.entries(dem);
	rep = d3.nest()
			.key(function(d) {return d.state;})
			.entries(rep);

	dem.forEach(function(d){
		d["winner"] = null;
		d["percentage"] = null;
		d.values.forEach(function(s){
			if (s.prop > d["percentage"]){
				d["percentage"] = s.prop;
				d["winner"] = s.candidate;
			}
		});
	})

	rep.forEach(function(d){
		d["winner"] = null;
		d["percentage"] = null;
		d.values.forEach(function(s){
			if (s.prop > d["percentage"]){
				d["percentage"] = s.prop;
				d["winner"] = s.candidate;
			}
		});
	})



	var visParty = function(){

		//console.log(partyArr);
		// create a map of our census data, so we can easily find records
		// correspondng to a particular state
		var censusMap = d3.map();
		partyArr.forEach(function(d){
			censusMap.set(d.key,d.values)});
		//console.log(censusMap);


		for (var i = 0; i < mapData.features.length; i++){
			var name = mapData.features[i].properties.name;
			mapData.features[i].properties.value = "hello there";
		}
/*
		// loop through all of the path data, attaching the appropriate
		// record to each one based on the name
		for (var i = 0; i < mapData.features.length; i++){
			var name = mapData.features[i].properties.name;
			//console.log(censusMap.get(name));
			var objArr = [censusMap.get(name)];
			//mapData.features[i].properties.value = objArr;
			mapData.features[i].properties.value = "x";
		}*/
		console.log(mapData);
				// create the states in the SVG

				var states = svg.selectAll("path")
				.data(mapData.features)
				.enter()
				.append("path")
				.attr("d", path)

				// style each state to set the fill color based on our metric
				states.style("fill", function(d){
						//console.log(d);

				})


				states.on("mouseover", function(d){
						var mouse = d3.mouse(svg.node());
					if(d.properties.value){
						tooltip.classed('hidden', false)
								.attr('style', 'left:' + (mouse[0]) + 'px; top:' + (mouse[1]) + 'px')
								.html(d.properties.value.prop);
							}
					else{
						tooltip.classed('hidden', false)
								.attr('style', 'left:' + (mouse[0]) + 'px; top:' + (mouse[1]) + 'px')
								.html("Race has not yet occurred");
							}
					})
				.on("mouseout", function(d){
					tooltip.classed('hidden', true)
				})



	}

=======
>>>>>>> ad8f219b0adbdc3f60a3ae7cc5d78995fdef3b2b
  var vis = function(){
            primaryData.forEach(function(d){
              if(d.candidate == candidateChoice){
                thisCandidate.push(d);
              }
            })
            console.log(thisCandidate);


      				// create a map of our census data, so we can easily find records
      				// correspondng to a particular state
      				var censusMap = d3.map();
      				thisCandidate.forEach(function(d){censusMap.set(d.state,d)});
<<<<<<< HEAD
							console.log(censusMap);
=======
>>>>>>> ad8f219b0adbdc3f60a3ae7cc5d78995fdef3b2b

      				// loop through all of the path data, attaching the appropriate
      				// record to each one based on the name
      				for (var i = 0; i < mapData.features.length; i++){
      					var name = mapData.features[i].properties.name;
      					mapData.features[i].properties.value = censusMap.get(name);
      				}

      				// create the states in the SVG
      				var states = svg.selectAll("path")
      				.data(mapData.features)
      				.enter()
      				.append("path")
      				.attr("d", path)
<<<<<<< HEAD
=======
      				.attr("class","state");
>>>>>>> ad8f219b0adbdc3f60a3ae7cc5d78995fdef3b2b

              // style each state to set the fill color based on our metric
      				states.style("fill", function(d){
      					if (d.properties.value){
      						return color(+d.properties.value.prop);
      					}	else{
      						return "red";
      					}

<<<<<<< HEAD
      				})

              states.on("mouseover", function(d){
									var mouse = d3.mouse(svg.node());
								if(d.properties.value){
									tooltip.classed('hidden', false)
											.attr('style', 'left:' + (mouse[0]) + 'px; top:' + (mouse[1]) + 'px')
											.html(d.properties.value.prop);
										}
								else{
									tooltip.classed('hidden', false)
											.attr('style', 'left:' + (mouse[0]) + 'px; top:' + (mouse[1]) + 'px')
											.html("Candidate did not compete in this race");
										}
								})
							.on("mouseout", function(d){
								tooltip.classed('hidden', true)
							})
		}
      vis();



      d3.select("#candidateSelect").on("change", function(){
              candidateChoice = this.value;
							svg.selectAll("path").remove();
              if(candidateChoice === "Democrats"){
								partyArr = dem;
								visParty();
							}
							if(candidateChoice === "Republicans"){
								partyArr = rep;
								visParty();
							}
							else{
              thisCandidate = [];
              vis();}
=======
      				});

              states.on("mouseover", function(d){
                if (d.properties.value){
                  console.log(d.properties.value.prop);
                    }
                else {
                  console.log("candidate did not compete");
                }
              });

}
      vis();

      d3.select("#candidateSelect").on("change", function(){
              console.log("hello");
              candidateChoice = this.value;
              console.log(this.value);
              svg.selectAll("path").remove();
              thisCandidate = [];
              vis();
>>>>>>> ad8f219b0adbdc3f60a3ae7cc5d78995fdef3b2b
            });

          });
        });
		</script>
	</body>
</html>
